<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JamMuse - Ask Anything About Jam Bands</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }

    /* Rainbow gradient for logo */
    .rainbow-text {
      background: linear-gradient(90deg,
        #ff0000 0%,
        #ff8000 17%,
        #ffff00 33%,
        #00ff00 50%,
        #00bfff 67%,
        #8000ff 83%,
        #ff00ff 100%
      );
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Band-specific gradients */
    .phish-gradient {
      background: linear-gradient(135deg, #e53e3e 0%, #ed8936 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .goose-gradient {
      background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .kglw-gradient {
      background: linear-gradient(135deg, #22c55e 0%, #84cc16 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .dead-gradient {
      background: linear-gradient(135deg, #dc2626 0%, #7c3aed 50%, #2563eb 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo-text {
      font-weight: 800;
      letter-spacing: -0.03em;
    }

    .query-input:focus {
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
    }

    .stat-card {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    }

    .typing-indicator span {
      animation: bounce 1.4s infinite ease-in-out;
    }
    .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
    .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }

    .rainbow-btn {
      background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff);
      background-size: 200% 200%;
      animation: gradient-shift 3s ease infinite;
    }

    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Band badge colors */
    .badge-dead { background: linear-gradient(135deg, #dc2626, #7c3aed, #2563eb); }
    .badge-phish { background: linear-gradient(135deg, #e53e3e, #ed8936); }
    .badge-goose { background: linear-gradient(135deg, #3b82f6, #06b6d4); }
    .badge-kglw { background: linear-gradient(135deg, #22c55e, #84cc16); }
    .badge-umphreys { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .badge-wsp { background: linear-gradient(135deg, #8b5cf6, #6366f1); }
    .badge-moe { background: linear-gradient(135deg, #ec4899, #f43f5e); }
    .badge-sts9 { background: linear-gradient(135deg, #06b6d4, #0891b2); }
    .badge-billy { background: linear-gradient(135deg, #a3e635, #65a30d); }

    /* Mascot container */
    .mascot-container {
      width: 72px;
      height: 72px;
      flex-shrink: 0;
      border-radius: 12px;
      overflow: hidden;
      background: rgba(255,255,255,0.05);
    }
  </style>
</head>
<body class="bg-gray-950 min-h-screen text-white">

  <!-- Header -->
  <header class="border-b border-gray-800">
    <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-lg flex items-center justify-center rainbow-btn">
          <span class="text-white font-black text-lg" style="text-shadow: 0 1px 2px rgba(0,0,0,0.3);">J</span>
        </div>
        <span class="logo-text text-2xl"><span class="rainbow-text">Jam</span><span class="text-white">Muse</span></span>
      </div>
      <div class="text-sm text-gray-500 hidden sm:block">
        Grateful Dead | Phish | Goose | King Gizzard | Umphrey's | Widespread | moe. | STS9 | Billy Strings
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto px-4 py-12">

    <!-- Hero Section -->
    <div class="text-center mb-8">
      <h1 class="text-4xl md:text-5xl font-extrabold mb-4">
        Your home for <span class="rainbow-text">jam band stats</span>
      </h1>
      <p class="text-gray-400 text-lg">
        Follow your groove.
      </p>
    </div>

    <!-- Query Input -->
    <form id="queryForm" class="relative mb-6">
      <input
        type="text"
        id="queryInput"
        placeholder="What's the longest Tweezer ever played?"
        class="query-input w-full pl-6 pr-20 py-4 bg-gray-900 border border-gray-700 rounded-2xl text-lg placeholder-gray-500 focus:outline-none focus:border-purple-500 transition"
        autocomplete="off"
      >
      <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 rainbow-btn px-5 py-2 rounded-xl font-semibold transition hover:opacity-90">
        Ask
      </button>
    </form>

    <!-- Featured Stats - Pre-answered questions -->
    <div id="featuredStats" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
      <!-- Cards will be populated by JavaScript -->
      <div class="stat-card rounded-2xl p-5 border border-gray-700 animate-pulse">
        <div class="h-4 bg-gray-700 rounded w-3/4 mb-3"></div>
        <div class="h-8 bg-gray-700 rounded w-1/2 mb-2"></div>
        <div class="h-3 bg-gray-700 rounded w-full"></div>
      </div>
      <div class="stat-card rounded-2xl p-5 border border-gray-700 animate-pulse">
        <div class="h-4 bg-gray-700 rounded w-3/4 mb-3"></div>
        <div class="h-8 bg-gray-700 rounded w-1/2 mb-2"></div>
        <div class="h-3 bg-gray-700 rounded w-full"></div>
      </div>
      <div class="stat-card rounded-2xl p-5 border border-gray-700 animate-pulse">
        <div class="h-4 bg-gray-700 rounded w-3/4 mb-3"></div>
        <div class="h-8 bg-gray-700 rounded w-1/2 mb-2"></div>
        <div class="h-3 bg-gray-700 rounded w-full"></div>
      </div>
      <div class="stat-card rounded-2xl p-5 border border-gray-700 animate-pulse">
        <div class="h-4 bg-gray-700 rounded w-3/4 mb-3"></div>
        <div class="h-8 bg-gray-700 rounded w-1/2 mb-2"></div>
        <div class="h-3 bg-gray-700 rounded w-full"></div>
      </div>
    </div>

    <!-- Chat History (appears after user asks a question) -->
    <div id="chatHistory" class="space-y-6">
    </div>

  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-800 mt-24">
    <div class="max-w-4xl mx-auto px-4 py-8 text-center text-gray-500 text-sm">
      <p class="mb-2"><span class="rainbow-text font-semibold">JamMuse</span> - Your AI-powered jam band encyclopedia</p>
      <p>Data from Phish.net, elgoose.net, kglw.net</p>
    </div>
  </footer>

  <script>
    const chatHistory = document.getElementById('chatHistory');
    const queryInput = document.getElementById('queryInput');
    const queryForm = document.getElementById('queryForm');

    // Mixed sample questions across all bands - always specify the band name
    const sampleQuestions = [
      // Grateful Dead - has duration data from Archive.org!
      "What's the longest Dark Star ever?",
      "How many times did the Dead play Eyes of the World?",
      "Longest Dead Playing in the Band?",
      "When did the Dead first play Scarlet Begonias?",
      "Top 10 longest Morning Dew",
      "Dead Estimated Prophet stats",
      // Phish
      "What's the longest Phish Tweezer?",
      "How many times has Phish played YEM?",
      "When did Phish last play Fluffhead?",
      "Longest Phish Ghost?",
      "How many times has Phish played Carini?",
      "What's the gap on Phish Harpua?",
      // Goose - has jam chart reviews
      "What's the longest Goose Arcadia?",
      "Best Goose Hungersite versions",
      "How many times has Goose played Tumble?",
      "When did Goose last play Madhuvan?",
      // King Gizzard - has jam chart reviews
      "What's the longest King Gizzard Dripping Tap?",
      "Best King Gizzard River versions",
      "How many times has King Gizzard played Rattlesnake?",
      "When did King Gizzard last play Head On/Pill?",
      // Umphrey's McGee
      "How many times has Umphrey's played Wizard Burial Ground?",
      "When did Umphrey's last play Mantis?",
      "Umphrey's Prowler stats",
      "What's the gap on Umphrey's All in Time?",
      // Widespread Panic
      "How many times has Widespread played Chilly Water?",
      "When did Panic last play Porch Song?",
      "Widespread Space Wrangler stats",
      "What's the gap on Panic Holden Oversoul?",
      // moe.
      "How many times has moe. played Rebubula?",
      "When did moe. last play Buster?",
      "moe. Meat stats",
      "What's the gap on moe. Spine of a Dog?",
      // STS9
      "How many times has STS9 played Scheme?",
      "When did STS9 last play Kamuy?",
      "STS9 World Go Round stats",
      // Billy Strings
      "How many times has Billy Strings played Dust in a Baggie?",
      "When did Billy Strings last play Meet Me at the Creek?",
      "Billy Strings Taking Water stats",
    ];

    // Band styling based on detected band
    const bandStyles = {
      'Grateful Dead': { gradient: 'dead-gradient', badge: 'badge-dead' },
      'Phish': { gradient: 'phish-gradient', badge: 'badge-phish' },
      'Goose': { gradient: 'goose-gradient', badge: 'badge-goose' },
      'King Gizzard': { gradient: 'kglw-gradient', badge: 'badge-kglw' },
      'King Gizzard & the Lizard Wizard': { gradient: 'kglw-gradient', badge: 'badge-kglw' },
      "Umphrey's McGee": { gradient: 'phish-gradient', badge: 'badge-umphreys' },
      'Widespread Panic': { gradient: 'dead-gradient', badge: 'badge-wsp' },
      'moe.': { gradient: 'phish-gradient', badge: 'badge-moe' },
      'STS9': { gradient: 'goose-gradient', badge: 'badge-sts9' },
      'Billy Strings': { gradient: 'kglw-gradient', badge: 'badge-billy' },
    };

    // Band mascot SVGs - StatMuse-style cartoon illustrations
    const bandMascots = {
      'Grateful Dead': `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Dancing Bear - inspired by iconic marching bear -->
          <circle cx="36" cy="36" r="32" fill="url(#dead-bg)"/>
          <!-- Bear body - slight tilt for dancing motion -->
          <ellipse cx="34" cy="44" rx="14" ry="16" fill="#FF6B6B" transform="rotate(-5 34 44)"/>
          <!-- Marching band collar - iconic contrasting neckband -->
          <ellipse cx="34" cy="30" rx="10" ry="4" fill="#FFD700"/>
          <ellipse cx="34" cy="30" rx="8" ry="3" fill="#FFA500"/>
          <!-- Bear head - tilted happy -->
          <circle cx="34" cy="22" r="11" fill="#FF6B6B"/>
          <!-- Ears - round and perky -->
          <circle cx="24" cy="14" r="5" fill="#FF6B6B"/>
          <circle cx="44" cy="14" r="5" fill="#FF6B6B"/>
          <circle cx="24" cy="14" r="3" fill="#E84545"/>
          <circle cx="44" cy="14" r="3" fill="#E84545"/>
          <!-- Happy closed eyes - classic dancing bear smile -->
          <path d="M28 20 Q30 18 32 20" stroke="#1a1a2e" stroke-width="2" fill="none" stroke-linecap="round"/>
          <path d="M36 20 Q38 18 40 20" stroke="#1a1a2e" stroke-width="2" fill="none" stroke-linecap="round"/>
          <!-- Big happy smile -->
          <path d="M28 26 Q34 32 40 26" stroke="#1a1a2e" stroke-width="2" fill="none" stroke-linecap="round"/>
          <!-- Nose -->
          <ellipse cx="34" cy="24" rx="2" ry="1.5" fill="#1a1a2e"/>
          <!-- Dancing arm raised HIGH - marching motion -->
          <ellipse cx="18" cy="28" rx="4" ry="9" fill="#FF6B6B" transform="rotate(-45 18 28)"/>
          <!-- Other arm out for balance -->
          <ellipse cx="50" cy="38" rx="4" ry="8" fill="#FF6B6B" transform="rotate(20 50 38)"/>
          <!-- One leg up - marching/dancing! -->
          <ellipse cx="28" cy="58" rx="5" ry="7" fill="#FF6B6B" transform="rotate(-10 28 58)"/>
          <!-- Other leg kicking out -->
          <ellipse cx="44" cy="54" rx="5" ry="7" fill="#FF6B6B" transform="rotate(25 44 54)"/>
          <!-- Motion lines for dancing energy -->
          <path d="M8 22 L12 24" stroke="rgba(255,255,255,0.6)" stroke-width="2" stroke-linecap="round"/>
          <path d="M6 28 L11 29" stroke="rgba(255,255,255,0.4)" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M56 50 L60 52" stroke="rgba(255,255,255,0.5)" stroke-width="1.5" stroke-linecap="round"/>
          <defs>
            <linearGradient id="dead-bg" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#7c3aed"/>
              <stop offset="100%" stop-color="#2563eb"/>
            </linearGradient>
          </defs>
        </svg>`,

      'Phish': `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Four fish on a hot dog -->
          <rect x="8" y="38" width="56" height="14" rx="7" fill="#F4A460"/>
          <rect x="10" y="36" width="52" height="10" rx="5" fill="#FFD700"/>
          <path d="M12 41 Q36 32 60 41" stroke="#CD853F" stroke-width="2" fill="none"/>
          <!-- Fish 1 - Red -->
          <ellipse cx="18" cy="30" rx="7" ry="5" fill="#e53e3e"/>
          <polygon points="10,30 6,25 6,35" fill="#e53e3e"/>
          <circle cx="21" cy="29" r="1.5" fill="white"/>
          <circle cx="21.5" cy="29" r="0.8" fill="#1a1a2e"/>
          <!-- Fish 2 - Blue -->
          <ellipse cx="30" cy="26" rx="7" ry="5" fill="#3b82f6"/>
          <polygon points="22,26 18,21 18,31" fill="#3b82f6"/>
          <circle cx="33" cy="25" r="1.5" fill="white"/>
          <circle cx="33.5" cy="25" r="0.8" fill="#1a1a2e"/>
          <!-- Fish 3 - Green -->
          <ellipse cx="42" cy="26" rx="7" ry="5" fill="#22c55e"/>
          <polygon points="50,26 54,21 54,31" fill="#22c55e"/>
          <circle cx="39" cy="25" r="1.5" fill="white"/>
          <circle cx="38.5" cy="25" r="0.8" fill="#1a1a2e"/>
          <!-- Fish 4 - Orange -->
          <ellipse cx="54" cy="30" rx="7" ry="5" fill="#ed8936"/>
          <polygon points="62,30 66,25 66,35" fill="#ed8936"/>
          <circle cx="51" cy="29" r="1.5" fill="white"/>
          <circle cx="50.5" cy="29" r="0.8" fill="#1a1a2e"/>
          <!-- Bun shine -->
          <ellipse cx="36" cy="52" rx="24" ry="4" fill="#DEB887"/>
        </svg>`,

      'Goose': `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Cool Goose -->
          <circle cx="36" cy="36" r="32" fill="url(#goose-bg)"/>
          <!-- Body -->
          <ellipse cx="36" cy="48" rx="18" ry="14" fill="white"/>
          <!-- Neck -->
          <path d="M36 38 Q32 28 36 18" stroke="white" stroke-width="12" fill="none" stroke-linecap="round"/>
          <!-- Head -->
          <circle cx="36" cy="16" r="10" fill="white"/>
          <!-- Beak -->
          <path d="M42 18 L54 16 L42 20 Z" fill="#ed8936"/>
          <!-- Cool sunglasses -->
          <rect x="28" y="12" width="8" height="5" rx="1" fill="#1a1a2e"/>
          <rect x="38" y="12" width="8" height="5" rx="1" fill="#1a1a2e"/>
          <line x1="36" y1="14" x2="38" y2="14" stroke="#1a1a2e" stroke-width="2"/>
          <line x1="28" y1="14" x2="24" y2="12" stroke="#1a1a2e" stroke-width="1.5"/>
          <line x1="46" y1="14" x2="50" y2="12" stroke="#1a1a2e" stroke-width="1.5"/>
          <!-- Wing -->
          <ellipse cx="28" cy="48" rx="8" ry="12" fill="#E8E8E8" transform="rotate(-10 28 48)"/>
          <!-- Feet -->
          <path d="M30 60 L26 68 M30 60 L30 68 M30 60 L34 68" stroke="#ed8936" stroke-width="2"/>
          <path d="M42 60 L38 68 M42 60 L42 68 M42 60 L46 68" stroke="#ed8936" stroke-width="2"/>
          <defs>
            <linearGradient id="goose-bg" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#3b82f6"/>
              <stop offset="100%" stop-color="#06b6d4"/>
            </linearGradient>
          </defs>
        </svg>`,

      'King Gizzard': `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Lizard Wizard -->
          <circle cx="36" cy="36" r="32" fill="url(#kglw-bg)"/>
          <!-- Wizard hat -->
          <polygon points="36,4 22,32 50,32" fill="#7c3aed"/>
          <ellipse cx="36" cy="32" rx="16" ry="4" fill="#6d28d9"/>
          <!-- Stars on hat -->
          <polygon points="32,16 33,19 30,17 34,17 31,19" fill="#fcd34d" transform="scale(0.8)"/>
          <polygon points="42,22 43,25 40,23 44,23 41,25" fill="#fcd34d" transform="scale(0.7)"/>
          <!-- Lizard head -->
          <ellipse cx="36" cy="42" rx="14" ry="10" fill="#22c55e"/>
          <!-- Snout -->
          <ellipse cx="36" cy="50" rx="8" ry="5" fill="#22c55e"/>
          <!-- Eyes - bulging lizard eyes -->
          <circle cx="28" cy="38" r="6" fill="#84cc16"/>
          <circle cx="44" cy="38" r="6" fill="#84cc16"/>
          <circle cx="29" cy="37" r="3" fill="#1a1a2e"/>
          <circle cx="45" cy="37" r="3" fill="#1a1a2e"/>
          <circle cx="30" cy="36" r="1" fill="white"/>
          <circle cx="46" cy="36" r="1" fill="white"/>
          <!-- Nostrils -->
          <circle cx="33" cy="52" r="1.5" fill="#15803d"/>
          <circle cx="39" cy="52" r="1.5" fill="#15803d"/>
          <!-- Smile -->
          <path d="M30 55 Q36 59 42 55" stroke="#15803d" stroke-width="2" fill="none"/>
          <!-- Scales detail -->
          <circle cx="36" cy="44" r="2" fill="#15803d" opacity="0.3"/>
          <defs>
            <linearGradient id="kglw-bg" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#22c55e"/>
              <stop offset="100%" stop-color="#15803d"/>
            </linearGradient>
          </defs>
        </svg>`,

      'King Gizzard & the Lizard Wizard': `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Lizard Wizard (same as above) -->
          <circle cx="36" cy="36" r="32" fill="url(#kglw-bg2)"/>
          <polygon points="36,4 22,32 50,32" fill="#7c3aed"/>
          <ellipse cx="36" cy="32" rx="16" ry="4" fill="#6d28d9"/>
          <polygon points="32,16 33,19 30,17 34,17 31,19" fill="#fcd34d" transform="scale(0.8)"/>
          <ellipse cx="36" cy="42" rx="14" ry="10" fill="#22c55e"/>
          <ellipse cx="36" cy="50" rx="8" ry="5" fill="#22c55e"/>
          <circle cx="28" cy="38" r="6" fill="#84cc16"/>
          <circle cx="44" cy="38" r="6" fill="#84cc16"/>
          <circle cx="29" cy="37" r="3" fill="#1a1a2e"/>
          <circle cx="45" cy="37" r="3" fill="#1a1a2e"/>
          <circle cx="30" cy="36" r="1" fill="white"/>
          <circle cx="46" cy="36" r="1" fill="white"/>
          <circle cx="33" cy="52" r="1.5" fill="#15803d"/>
          <circle cx="39" cy="52" r="1.5" fill="#15803d"/>
          <path d="M30 55 Q36 59 42 55" stroke="#15803d" stroke-width="2" fill="none"/>
          <defs>
            <linearGradient id="kglw-bg2" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#22c55e"/>
              <stop offset="100%" stop-color="#15803d"/>
            </linearGradient>
          </defs>
        </svg>`,

      'Widespread Panic': `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Panicking crowd -->
          <circle cx="36" cy="36" r="32" fill="url(#wsp-bg)"/>
          <!-- Person 1 - arms up panicking -->
          <circle cx="20" cy="28" r="6" fill="#FFD5B5"/>
          <ellipse cx="20" cy="46" rx="6" ry="10" fill="#8b5cf6"/>
          <line x1="14" y1="38" x2="8" y2="28" stroke="#FFD5B5" stroke-width="3" stroke-linecap="round"/>
          <line x1="26" y1="38" x2="30" y2="26" stroke="#FFD5B5" stroke-width="3" stroke-linecap="round"/>
          <circle cx="18" cy="26" r="1" fill="#1a1a2e"/>
          <circle cx="22" cy="26" r="1" fill="#1a1a2e"/>
          <ellipse cx="20" cy="30" rx="2" ry="1" fill="#1a1a2e"/>
          <!-- Person 2 - center, really panicking -->
          <circle cx="36" cy="24" r="7" fill="#FFD5B5"/>
          <ellipse cx="36" cy="44" rx="7" ry="12" fill="#6366f1"/>
          <line x1="29" y1="34" x2="20" y2="24" stroke="#FFD5B5" stroke-width="3" stroke-linecap="round"/>
          <line x1="43" y1="34" x2="52" y2="24" stroke="#FFD5B5" stroke-width="3" stroke-linecap="round"/>
          <circle cx="33" cy="22" r="1.5" fill="#1a1a2e"/>
          <circle cx="39" cy="22" r="1.5" fill="#1a1a2e"/>
          <ellipse cx="36" cy="28" rx="3" ry="2" fill="#1a1a2e"/>
          <!-- Person 3 - arms up -->
          <circle cx="52" cy="28" r="6" fill="#FFD5B5"/>
          <ellipse cx="52" cy="46" rx="6" ry="10" fill="#8b5cf6"/>
          <line x1="46" y1="38" x2="42" y2="26" stroke="#FFD5B5" stroke-width="3" stroke-linecap="round"/>
          <line x1="58" y1="38" x2="64" y2="28" stroke="#FFD5B5" stroke-width="3" stroke-linecap="round"/>
          <circle cx="50" cy="26" r="1" fill="#1a1a2e"/>
          <circle cx="54" cy="26" r="1" fill="#1a1a2e"/>
          <ellipse cx="52" cy="30" rx="2" ry="1" fill="#1a1a2e"/>
          <!-- Sweat drops / panic lines -->
          <path d="M16 18 L14 14" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M56 18 L58 14" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M36 14 L36 10" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
          <defs>
            <linearGradient id="wsp-bg" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#8b5cf6"/>
              <stop offset="100%" stop-color="#6366f1"/>
            </linearGradient>
          </defs>
        </svg>`,

      "Umphrey's McGee": `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Angular prog-rock UM character -->
          <circle cx="36" cy="36" r="32" fill="url(#um-bg)"/>
          <!-- Geometric U shape head -->
          <path d="M24 20 L24 40 Q24 52 36 52 Q48 52 48 40 L48 20" stroke="#f59e0b" stroke-width="8" fill="none" stroke-linecap="round"/>
          <!-- Cool angular sunglasses -->
          <polygon points="26,28 34,28 32,34 24,34" fill="#1a1a2e"/>
          <polygon points="38,28 46,28 48,34 40,34" fill="#1a1a2e"/>
          <line x1="34" y1="30" x2="38" y2="30" stroke="#1a1a2e" stroke-width="2"/>
          <!-- Lightning bolt accent -->
          <polygon points="52,16 48,28 52,28 46,42 50,30 46,30" fill="#fcd34d"/>
          <!-- M shape below -->
          <path d="M20 58 L28 48 L36 56 L44 48 L52 58" stroke="#d97706" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          <defs>
            <linearGradient id="um-bg" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#f59e0b"/>
              <stop offset="100%" stop-color="#d97706"/>
            </linearGradient>
          </defs>
        </svg>`,

      'moe.': `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Quirky moe. character -->
          <circle cx="36" cy="36" r="32" fill="url(#moe-bg)"/>
          <!-- Round goofy head -->
          <circle cx="36" cy="32" r="18" fill="#FFE4C4"/>
          <!-- Wild hair -->
          <path d="M22 22 Q18 12 26 16 Q24 8 34 14 Q36 6 42 14 Q50 8 48 18 Q56 14 52 24" stroke="#4a3728" stroke-width="4" fill="none" stroke-linecap="round"/>
          <!-- Big goofy eyes -->
          <circle cx="30" cy="30" r="5" fill="white"/>
          <circle cx="42" cy="30" r="5" fill="white"/>
          <circle cx="31" cy="31" r="2.5" fill="#1a1a2e"/>
          <circle cx="43" cy="31" r="2.5" fill="#1a1a2e"/>
          <!-- Wide grin -->
          <path d="M28 40 Q36 48 44 40" stroke="#1a1a2e" stroke-width="2" fill="none"/>
          <!-- Tongue out -->
          <ellipse cx="36" cy="44" rx="4" ry="3" fill="#ec4899"/>
          <!-- moe. text hint -->
          <text x="36" y="62" font-size="10" fill="white" text-anchor="middle" font-weight="bold">moe.</text>
          <defs>
            <linearGradient id="moe-bg" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#ec4899"/>
              <stop offset="100%" stop-color="#f43f5e"/>
            </linearGradient>
          </defs>
        </svg>`,

      'STS9': `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Futuristic space tribal -->
          <circle cx="36" cy="36" r="32" fill="url(#sts9-bg)"/>
          <!-- Geometric tribal head -->
          <polygon points="36,12 52,28 52,48 36,58 20,48 20,28" fill="#0891b2" stroke="#06b6d4" stroke-width="2"/>
          <!-- Inner geometric pattern -->
          <polygon points="36,18 46,30 46,44 36,52 26,44 26,30" fill="#0e7490"/>
          <!-- Glowing eyes -->
          <circle cx="30" cy="34" r="4" fill="#22d3ee"/>
          <circle cx="42" cy="34" r="4" fill="#22d3ee"/>
          <circle cx="30" cy="34" r="2" fill="white"/>
          <circle cx="42" cy="34" r="2" fill="white"/>
          <!-- Circuit-like patterns -->
          <line x1="36" y1="24" x2="36" y2="18" stroke="#22d3ee" stroke-width="1.5"/>
          <line x1="36" y1="46" x2="36" y2="52" stroke="#22d3ee" stroke-width="1.5"/>
          <circle cx="36" cy="40" r="3" stroke="#22d3ee" stroke-width="1.5" fill="none"/>
          <!-- Orbital rings -->
          <ellipse cx="36" cy="36" rx="28" ry="8" stroke="#22d3ee" stroke-width="1" fill="none" opacity="0.5" transform="rotate(-20 36 36)"/>
          <defs>
            <linearGradient id="sts9-bg" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#0891b2"/>
              <stop offset="100%" stop-color="#0e7490"/>
            </linearGradient>
          </defs>
        </svg>`,

      'Billy Strings': `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Bluegrass picker -->
          <circle cx="36" cy="36" r="32" fill="url(#billy-bg)"/>
          <!-- Hat -->
          <ellipse cx="36" cy="20" rx="16" ry="4" fill="#4a3728"/>
          <rect x="26" y="10" width="20" height="12" rx="2" fill="#5c4033"/>
          <!-- Face -->
          <circle cx="36" cy="32" r="12" fill="#FFE4C4"/>
          <!-- Beard -->
          <path d="M26 36 Q26 50 36 52 Q46 50 46 36" fill="#4a3728"/>
          <!-- Eyes -->
          <circle cx="32" cy="30" r="2" fill="#1a1a2e"/>
          <circle cx="40" cy="30" r="2" fill="#1a1a2e"/>
          <!-- Guitar -->
          <ellipse cx="36" cy="56" rx="12" ry="8" fill="#d97706"/>
          <ellipse cx="36" cy="56" rx="4" ry="3" fill="#1a1a2e"/>
          <rect x="34" y="38" width="4" height="12" fill="#8B4513"/>
          <!-- Guitar strings -->
          <line x1="33" y1="44" x2="33" y2="64" stroke="#fcd34d" stroke-width="0.5"/>
          <line x1="36" y1="44" x2="36" y2="64" stroke="#fcd34d" stroke-width="0.5"/>
          <line x1="39" y1="44" x2="39" y2="64" stroke="#fcd34d" stroke-width="0.5"/>
          <!-- Hand on guitar -->
          <ellipse cx="44" cy="52" rx="4" ry="3" fill="#FFE4C4" transform="rotate(-20 44 52)"/>
          <defs>
            <linearGradient id="billy-bg" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#65a30d"/>
              <stop offset="100%" stop-color="#4d7c0f"/>
            </linearGradient>
          </defs>
        </svg>`,
    };

    // Color palettes for mascot variations - each bear gets a complementary background
    const bearColors = [
      { body: '#FF6B6B', accent: '#E84545', collar: '#FFD700', collarInner: '#FFA500', bg1: '#7c3aed', bg2: '#2563eb' }, // Red bear on purple/blue
      { body: '#FF8C00', accent: '#E67300', collar: '#FFD700', collarInner: '#FFA500', bg1: '#1e3a5f', bg2: '#0f172a' }, // Orange bear on dark blue
      { body: '#FFD700', accent: '#E6C200', collar: '#FF6B6B', collarInner: '#E84545', bg1: '#7c3aed', bg2: '#4c1d95' }, // Yellow bear on purple
      { body: '#4ECDC4', accent: '#3DB8B0', collar: '#FFD700', collarInner: '#FFA500', bg1: '#be185d', bg2: '#831843' }, // Teal bear on magenta
      { body: '#9B59B6', accent: '#8E44AD', collar: '#FFD700', collarInner: '#FFA500', bg1: '#065f46', bg2: '#064e3b' }, // Purple bear on emerald
      { body: '#3498DB', accent: '#2980B9', collar: '#FFD700', collarInner: '#FFA500', bg1: '#9f1239', bg2: '#881337' }, // Blue bear on rose
      { body: '#E74C3C', accent: '#C0392B', collar: '#2ECC71', collarInner: '#27AE60', bg1: '#1e40af', bg2: '#1e3a8a' }, // Red/Green bear on blue
      { body: '#F472B6', accent: '#EC4899', collar: '#FFD700', collarInner: '#FFA500', bg1: '#115e59', bg2: '#134e4a' }, // Pink bear on teal
      { body: '#34D399', accent: '#10B981', collar: '#FFD700', collarInner: '#FFA500', bg1: '#7e22ce', bg2: '#6b21a8' }, // Green bear on violet
    ];

    const gooseBackgrounds = [
      { bg1: '#3b82f6', bg2: '#06b6d4' },   // Blue/Cyan
      { bg1: '#8b5cf6', bg2: '#a855f7' },   // Purple
      { bg1: '#ec4899', bg2: '#f43f5e' },   // Pink
      { bg1: '#f59e0b', bg2: '#f97316' },   // Orange
      { bg1: '#10b981', bg2: '#14b8a6' },   // Green
      { bg1: '#6366f1', bg2: '#8b5cf6' },   // Indigo
    ];

    const fishColorSets = [
      ['#e53e3e', '#3b82f6', '#22c55e', '#ed8936'], // Classic
      ['#8b5cf6', '#ec4899', '#06b6d4', '#f59e0b'], // Vibrant
      ['#ef4444', '#f97316', '#eab308', '#22c55e'], // Warm rainbow
      ['#06b6d4', '#3b82f6', '#8b5cf6', '#ec4899'], // Cool spectrum
      ['#14b8a6', '#22c55e', '#84cc16', '#eab308'], // Green vibes
      ['#f43f5e', '#fb7185', '#f472b6', '#e879f9'], // Pink party
    ];

    // Generate a bear mascot with specific colors
    function generateBearMascot(colors) {
      return `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="36" cy="36" r="32" fill="url(#dead-bg-${colors.body.slice(1)})"/>
          <ellipse cx="34" cy="44" rx="14" ry="16" fill="${colors.body}" transform="rotate(-5 34 44)"/>
          <ellipse cx="34" cy="30" rx="10" ry="4" fill="${colors.collar}"/>
          <ellipse cx="34" cy="30" rx="8" ry="3" fill="${colors.collarInner}"/>
          <circle cx="34" cy="22" r="11" fill="${colors.body}"/>
          <circle cx="24" cy="14" r="5" fill="${colors.body}"/>
          <circle cx="44" cy="14" r="5" fill="${colors.body}"/>
          <circle cx="24" cy="14" r="3" fill="${colors.accent}"/>
          <circle cx="44" cy="14" r="3" fill="${colors.accent}"/>
          <path d="M28 20 Q30 18 32 20" stroke="#1a1a2e" stroke-width="2" fill="none" stroke-linecap="round"/>
          <path d="M36 20 Q38 18 40 20" stroke="#1a1a2e" stroke-width="2" fill="none" stroke-linecap="round"/>
          <path d="M28 26 Q34 32 40 26" stroke="#1a1a2e" stroke-width="2" fill="none" stroke-linecap="round"/>
          <ellipse cx="34" cy="24" rx="2" ry="1.5" fill="#1a1a2e"/>
          <ellipse cx="18" cy="28" rx="4" ry="9" fill="${colors.body}" transform="rotate(-45 18 28)"/>
          <ellipse cx="50" cy="38" rx="4" ry="8" fill="${colors.body}" transform="rotate(20 50 38)"/>
          <ellipse cx="28" cy="58" rx="5" ry="7" fill="${colors.body}" transform="rotate(-10 28 58)"/>
          <ellipse cx="44" cy="54" rx="5" ry="7" fill="${colors.body}" transform="rotate(25 44 54)"/>
          <path d="M8 22 L12 24" stroke="rgba(255,255,255,0.6)" stroke-width="2" stroke-linecap="round"/>
          <path d="M6 28 L11 29" stroke="rgba(255,255,255,0.4)" stroke-width="1.5" stroke-linecap="round"/>
          <defs>
            <linearGradient id="dead-bg-${colors.body.slice(1)}" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="${colors.bg1}"/>
              <stop offset="100%" stop-color="${colors.bg2}"/>
            </linearGradient>
          </defs>
        </svg>`;
    }

    // Generate goose mascot with specific background
    function generateGooseMascot(bg) {
      return `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="36" cy="36" r="32" fill="url(#goose-bg-${bg.bg1.slice(1)})"/>
          <ellipse cx="36" cy="48" rx="18" ry="14" fill="white"/>
          <path d="M36 38 Q32 28 36 18" stroke="white" stroke-width="12" fill="none" stroke-linecap="round"/>
          <circle cx="36" cy="16" r="10" fill="white"/>
          <path d="M42 18 L54 16 L42 20 Z" fill="#ed8936"/>
          <rect x="28" y="12" width="8" height="5" rx="1" fill="#1a1a2e"/>
          <rect x="38" y="12" width="8" height="5" rx="1" fill="#1a1a2e"/>
          <line x1="36" y1="14" x2="38" y2="14" stroke="#1a1a2e" stroke-width="2"/>
          <line x1="28" y1="14" x2="24" y2="12" stroke="#1a1a2e" stroke-width="1.5"/>
          <line x1="46" y1="14" x2="50" y2="12" stroke="#1a1a2e" stroke-width="1.5"/>
          <ellipse cx="28" cy="48" rx="8" ry="12" fill="#E8E8E8" transform="rotate(-10 28 48)"/>
          <path d="M30 60 L26 68 M30 60 L30 68 M30 60 L34 68" stroke="#ed8936" stroke-width="2"/>
          <path d="M42 60 L38 68 M42 60 L42 68 M42 60 L46 68" stroke="#ed8936" stroke-width="2"/>
          <defs>
            <linearGradient id="goose-bg-${bg.bg1.slice(1)}" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="${bg.bg1}"/>
              <stop offset="100%" stop-color="${bg.bg2}"/>
            </linearGradient>
          </defs>
        </svg>`;
    }

    // Generate phish mascot with specific fish colors
    function generatePhishMascot(fishColors) {
      return `
        <svg viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="8" y="38" width="56" height="14" rx="7" fill="#F4A460"/>
          <rect x="10" y="36" width="52" height="10" rx="5" fill="#FFD700"/>
          <path d="M12 41 Q36 32 60 41" stroke="#CD853F" stroke-width="2" fill="none"/>
          <ellipse cx="18" cy="30" rx="7" ry="5" fill="${fishColors[0]}"/>
          <polygon points="10,30 6,25 6,35" fill="${fishColors[0]}"/>
          <circle cx="21" cy="29" r="1.5" fill="white"/>
          <circle cx="21.5" cy="29" r="0.8" fill="#1a1a2e"/>
          <ellipse cx="30" cy="26" rx="7" ry="5" fill="${fishColors[1]}"/>
          <polygon points="22,26 18,21 18,31" fill="${fishColors[1]}"/>
          <circle cx="33" cy="25" r="1.5" fill="white"/>
          <circle cx="33.5" cy="25" r="0.8" fill="#1a1a2e"/>
          <ellipse cx="42" cy="26" rx="7" ry="5" fill="${fishColors[2]}"/>
          <polygon points="50,26 54,21 54,31" fill="${fishColors[2]}"/>
          <circle cx="39" cy="25" r="1.5" fill="white"/>
          <circle cx="38.5" cy="25" r="0.8" fill="#1a1a2e"/>
          <ellipse cx="54" cy="30" rx="7" ry="5" fill="${fishColors[3]}"/>
          <polygon points="62,30 66,25 66,35" fill="${fishColors[3]}"/>
          <circle cx="51" cy="29" r="1.5" fill="white"/>
          <circle cx="50.5" cy="29" r="0.8" fill="#1a1a2e"/>
          <ellipse cx="36" cy="52" rx="24" ry="4" fill="#DEB887"/>
        </svg>`;
    }

    // Get mascot for a band with random color variation
    function getBandMascot(bandName) {
      if (bandName === 'Grateful Dead') {
        const colors = bearColors[Math.floor(Math.random() * bearColors.length)];
        return generateBearMascot(colors);
      }
      if (bandName === 'Goose') {
        const bg = gooseBackgrounds[Math.floor(Math.random() * gooseBackgrounds.length)];
        return generateGooseMascot(bg);
      }
      if (bandName === 'Phish') {
        const colors = fishColorSets[Math.floor(Math.random() * fishColorSets.length)];
        return generatePhishMascot(colors);
      }
      return bandMascots[bandName] || generateBearMascot(bearColors[0]); // Default to red bear
    }

    // Featured questions - curated for impressive stats on homepage
    const featuredQuestions = [
      // LONGEST - all bands
      "What's the longest Dark Star ever?",
      "Longest Phish Tweezer ever?",
      "What's the longest Goose Arcadia?",
      "What's the longest King Gizzard Dripping Tap?",
      "Longest Dead Morning Dew?",
      "Longest Phish Ghost ever?",

      // TIMES PLAYED - all bands
      "How many times has Phish played YEM?",
      "How many times has Goose played Hungersite?",
      "How many times did the Dead play Eyes of the World?",
      "How many times has King Gizzard played Rattlesnake?",
      "How many times has Phish played Carini?",

      // GAP - Phish only (they're still touring!)
      "What's the gap on Phish Harpua?",
      "What's the Phish Fluffhead gap?",
      "What's the gap on Phish Destiny Unbound?",
      "Phish gap on Brother?",

      // DEBUT - all bands (natural language: "When did X debut Y?" or "When did X first play Y?")
      "When did Phish debut Tweezer?",
      "When did the Dead debut Eyes of the World?",
      "When did Goose debut Arcadia?",
      "When did King Gizzard debut Dripping Tap?",
      "When did Phish debut Sigma Oasis?",
      "When did the Dead debut Scarlet Begonias?",
    ];

    function getRandomFeatured(count = 4) {
      const shuffled = [...featuredQuestions].sort(() => Math.random() - 0.5);
      return shuffled.slice(0, count);
    }

    function createFeaturedCard(data, question, index) {
      const band = data.band || 'Unknown';
      const style = getBandStyle(band);

      let statValue = data.highlight || '';
      let statLabel = '';
      let title = '';
      let subtitle = '';
      let queryType = '';

      // Determine query type from the question
      const qLower = question.toLowerCase();
      if (qLower.includes('longest')) {
        queryType = 'Longest';
      } else if (qLower.includes('how many') || qLower.includes('times')) {
        queryType = 'Play Count';
      } else if (qLower.includes('best')) {
        queryType = 'Best';
      } else if (qLower.includes('gap')) {
        queryType = 'Gap';
      } else if (qLower.includes('last')) {
        queryType = 'Last Played';
      }

      if (data.card) {
        // Get the song name from the card title
        let songName = data.card.title || '';
        // Clean up song name - remove prefixes/suffixes that might already be there
        songName = songName.replace(/^Longest\s+/i, '');
        songName = songName.replace(/\s+versions?$/i, '');
        songName = songName.replace(/\s+debut$/i, '');

        // Generate natural language title based on query type
        // Check question first, then fall back to card type
        if (qLower.includes('longest')) {
          title = `Longest ${songName} Ever`;
          statValue = data.card.stat || statValue;
          statLabel = 'duration';
          subtitle = data.card.subtitle || '';
        } else if (qLower.includes('how many') || qLower.includes('times played')) {
          title = `Times Played: ${songName}`;
          statValue = data.card.stat || statValue;
          statLabel = 'performances';
          if (data.card.extra && data.card.extra.last_played) {
            subtitle = `Last played: ${data.card.extra.last_played}`;
          }
        } else if (qLower.includes('gap')) {
          title = `Current Gap: ${songName}`;
          statValue = data.card.stat || statValue;
          statLabel = 'shows ago';
          if (data.card.extra && data.card.extra.last_played) {
            subtitle = `Last played: ${data.card.extra.last_played}`;
          }
        } else if (qLower.includes('debut') || qLower.includes('first play')) {
          title = `${songName} Debut`;
          statValue = data.card.stat || statValue;
          statLabel = 'first played';
          subtitle = data.card.subtitle || '';
        } else if (data.card.type === 'longest') {
          title = `Longest ${songName} Ever`;
          statValue = data.card.stat || statValue;
          statLabel = 'duration';
          subtitle = data.card.subtitle || '';
        } else if (data.card.type === 'count') {
          title = `Times Played: ${songName}`;
          statValue = data.card.stat || statValue;
          statLabel = 'performances';
          subtitle = '';
        } else {
          // Default
          title = songName;
          statValue = data.card.stat || statValue;
          statLabel = data.card.stat_label || '';
          subtitle = data.card.subtitle || '';
        }
      }

      // Get the mascot for this band
      const mascot = getBandMascot(band);

      // Use data attribute to store question (avoids quote escaping issues in onclick)
      return `
        <div class="featured-card stat-card rounded-2xl p-5 border border-gray-700 cursor-pointer hover:border-gray-500 transition group" data-question="${encodeURIComponent(question)}">
          <div class="flex items-start gap-4">
            <!-- Mascot -->
            <div class="mascot-container">
              ${mascot}
            </div>
            <!-- Content -->
            <div class="flex-1 min-w-0">
              <span class="${style.badge} text-white text-xs font-bold px-2 py-0.5 rounded-full">${escapeHtml(band)}</span>
              <h3 class="${title.length > 25 ? 'text-base' : 'text-lg'} font-bold text-white mt-2 leading-tight">${escapeHtml(title)}</h3>
              <p class="text-gray-400 text-sm leading-tight">${escapeHtml(subtitle)}</p>
            </div>
            <!-- Stat -->
            <div class="text-right flex-shrink-0">
              <p class="text-3xl font-extrabold ${style.gradient}">${escapeHtml(statValue)}</p>
              <p class="text-gray-500 text-xs">${escapeHtml(statLabel)}</p>
            </div>
          </div>
          <p class="text-gray-500 text-xs mt-3 group-hover:text-gray-400 transition">Click to explore →</p>
        </div>
      `;
    }

    // Event delegation for featured cards (handles clicks reliably)
    document.getElementById('featuredStats').addEventListener('click', (e) => {
      const card = e.target.closest('.featured-card');
      if (card && card.dataset.question) {
        const question = decodeURIComponent(card.dataset.question);
        askQuestion(question);
      }
    });

    async function loadFeaturedStats() {
      const container = document.getElementById('featuredStats');
      const questions = getRandomFeatured(4);

      // Fetch all 4 in parallel
      const promises = questions.map(async (q) => {
        try {
          const response = await fetch('/api/jammuse/query', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question: q })
          });
          const data = await response.json();
          return { data, question: q };
        } catch (e) {
          return null;
        }
      });

      const results = await Promise.all(promises);
      const validResults = results.filter(r => r && r.data && r.data.success);

      if (validResults.length > 0) {
        container.innerHTML = validResults.map((r, i) => createFeaturedCard(r.data, r.question, i)).join('');
      } else {
        // Fallback to clickable suggestions if API fails
        container.innerHTML = questions.map(q => `
          <div class="featured-card stat-card rounded-2xl p-5 border border-gray-700 cursor-pointer hover:border-gray-500 transition" data-question="${encodeURIComponent(q)}">
            <p class="text-gray-300">${escapeHtml(q)}</p>
            <p class="text-gray-500 text-xs mt-2">Click to search →</p>
          </div>
        `).join('');
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadFeaturedStats();
      // Randomize placeholder
      const randomQ = sampleQuestions[Math.floor(Math.random() * sampleQuestions.length)];
      queryInput.placeholder = randomQ;
    });

    function askQuestion(question) {
      queryInput.value = question;
      submitQuery(question);
    }

    function addUserMessage(question) {
      chatHistory.innerHTML = '';

      const div = document.createElement('div');
      div.className = 'flex justify-end';
      div.innerHTML = `
        <div class="bg-purple-500/20 border border-purple-500/30 rounded-2xl rounded-br-md px-5 py-3 max-w-md">
          <p class="text-purple-200">${escapeHtml(question)}</p>
        </div>
      `;
      chatHistory.appendChild(div);
      scrollToBottom();
    }

    function addTypingIndicator() {
      const div = document.createElement('div');
      div.id = 'typing';
      div.className = 'flex justify-start';
      div.innerHTML = `
        <div class="bg-gray-900 border border-gray-800 rounded-2xl rounded-bl-md px-5 py-4">
          <div class="typing-indicator flex gap-1">
            <span class="w-2 h-2 bg-gray-500 rounded-full"></span>
            <span class="w-2 h-2 bg-gray-500 rounded-full"></span>
            <span class="w-2 h-2 bg-gray-500 rounded-full"></span>
          </div>
        </div>
      `;
      chatHistory.appendChild(div);
      scrollToBottom();
    }

    function removeTypingIndicator() {
      const typing = document.getElementById('typing');
      if (typing) typing.remove();
    }

    function getBandStyle(bandName) {
      return bandStyles[bandName] || { gradient: 'rainbow-text', badge: 'rainbow-btn' };
    }

    function addBotResponse(data) {
      removeTypingIndicator();

      const band = data.band || 'Unknown';
      const style = getBandStyle(band);

      const div = document.createElement('div');
      div.className = 'flex justify-start';

      // Band badge
      const bandBadge = band ? `
        <span class="${style.badge} text-white text-xs font-bold px-2 py-1 rounded-full mb-2 inline-block">
          ${escapeHtml(band)}
        </span>
      ` : '';

      let cardHtml = '';
      if (data.card) {
        if (data.card.type === 'longest') {
          cardHtml = `
            <div class="stat-card rounded-2xl p-6 border border-gray-700 mt-4">
              <div class="flex items-start justify-between mb-4">
                <div>
                  <p class="text-gray-400 text-sm uppercase tracking-wide">Longest Performance</p>
                  <h2 class="text-2xl font-bold text-white mt-1">${escapeHtml(data.card.title)}</h2>
                </div>
                <div class="text-right">
                  <p class="text-4xl font-extrabold ${style.gradient}">${escapeHtml(data.card.stat)}</p>
                  <p class="text-gray-500 text-sm">duration</p>
                </div>
              </div>
              <div class="border-t border-gray-700 pt-4">
                <p class="text-gray-300">${escapeHtml(data.card.subtitle || '')}</p>
                ${data.card.context ? `<p class="text-gray-500 text-sm mt-1">${escapeHtml(data.card.context)}</p>` : ''}
              </div>
              ${data.card.extra ? `
                <div class="grid grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-700">
                  <div>
                    <p class="text-gray-500 text-xs">Avg Duration</p>
                    <p class="text-white font-semibold">${escapeHtml(data.card.extra.avg_duration || 'N/A')}</p>
                  </div>
                  <div>
                    <p class="text-gray-500 text-xs">Performances</p>
                    <p class="text-white font-semibold">${data.card.extra.performances_with_data || data.card.extra.total_performances || 'N/A'}</p>
                  </div>
                </div>
              ` : ''}
            </div>
          `;
        } else if (data.card.type === 'count' || data.card.type === 'stats' || data.card.type === 'gap') {
          cardHtml = `
            <div class="stat-card rounded-2xl p-6 border border-gray-700 mt-4">
              <div class="flex items-center justify-between">
                <div>
                  <h2 class="text-2xl font-bold text-white">${escapeHtml(data.card.title)}</h2>
                  <p class="text-gray-400 text-sm mt-1">${escapeHtml(data.card.subtitle || '')}</p>
                </div>
                ${data.card.stat !== undefined ? `
                  <div class="text-center">
                    <p class="text-5xl font-extrabold ${style.gradient}">${data.card.stat}</p>
                    <p class="text-gray-500 text-sm">${escapeHtml(data.card.stat_label || '')}</p>
                  </div>
                ` : ''}
              </div>
              ${data.card.extra ? `
                <div class="grid grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-700">
                  ${data.card.extra.first_played ? `
                    <div>
                      <p class="text-gray-500 text-xs">First Played</p>
                      <p class="text-white font-semibold">${escapeHtml(data.card.extra.first_played)}</p>
                    </div>
                  ` : ''}
                  ${data.card.extra.last_played ? `
                    <div>
                      <p class="text-gray-500 text-xs">Last Played</p>
                      <p class="text-white font-semibold">${escapeHtml(data.card.extra.last_played)}</p>
                    </div>
                  ` : ''}
                  ${data.card.extra.gap !== undefined ? `
                    <div>
                      <p class="text-gray-500 text-xs">Current Gap</p>
                      <p class="text-white font-semibold">${data.card.extra.gap} shows</p>
                    </div>
                  ` : ''}
                  ${data.card.extra.jamchart_count !== undefined ? `
                    <div>
                      <p class="text-gray-500 text-xs">Jam Charted</p>
                      <p class="text-white font-semibold">${data.card.extra.jamchart_count} times (${data.card.extra.jamchart_rate || 'N/A'})</p>
                    </div>
                  ` : ''}
                  ${data.card.extra.venue ? `
                    <div class="col-span-2">
                      <p class="text-gray-500 text-xs">Venue</p>
                      <p class="text-white font-semibold">${escapeHtml(data.card.extra.venue)}</p>
                    </div>
                  ` : ''}
                </div>
              ` : ''}
            </div>
          `;
        } else if (data.card.type === 'jamchart') {
          cardHtml = `
            <div class="stat-card rounded-2xl p-6 border border-gray-700 mt-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-400 text-sm uppercase tracking-wide">Jam Chart</p>
                  <h2 class="text-2xl font-bold text-white mt-1">${escapeHtml(data.card.title)}</h2>
                </div>
                ${data.card.extra && data.card.extra.entries ? `
                  <div class="text-center">
                    <p class="text-4xl font-extrabold ${style.gradient}">${data.card.extra.entries}</p>
                    <p class="text-gray-500 text-sm">entries</p>
                  </div>
                ` : ''}
              </div>
            </div>
          `;
        } else if (data.card.type === 'duration') {
          cardHtml = `
            <div class="stat-card rounded-2xl p-6 border border-gray-700 mt-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-400 text-sm uppercase tracking-wide">Average Duration</p>
                  <h2 class="text-2xl font-bold text-white mt-1">${escapeHtml(data.card.title)}</h2>
                </div>
                <div class="text-center">
                  <p class="text-4xl font-extrabold ${style.gradient}">${escapeHtml(data.card.stat)}</p>
                  <p class="text-gray-500 text-sm">${escapeHtml(data.card.stat_label || 'minutes')}</p>
                </div>
              </div>
              ${data.card.extra ? `
                <div class="grid grid-cols-3 gap-4 mt-4 pt-4 border-t border-gray-700">
                  <div>
                    <p class="text-gray-500 text-xs">Shortest</p>
                    <p class="text-white font-semibold">${escapeHtml(data.card.extra.min || 'N/A')}</p>
                  </div>
                  <div>
                    <p class="text-gray-500 text-xs">Longest</p>
                    <p class="text-white font-semibold">${escapeHtml(data.card.extra.max || 'N/A')}</p>
                  </div>
                  <div>
                    <p class="text-gray-500 text-xs">Samples</p>
                    <p class="text-white font-semibold">${data.card.extra.count || 'N/A'}</p>
                  </div>
                </div>
              ` : ''}
            </div>
          `;
        }
      }

      let relatedHtml = '';
      if (data.related && data.related.length > 0) {
        relatedHtml = `
          <div class="flex flex-wrap gap-2 mt-4">
            <span class="text-gray-500 text-sm">Related:</span>
            ${data.related.map(q => `
              <button onclick="askQuestion('${escapeHtml(q)}')" class="px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-sm transition">${escapeHtml(q)}</button>
            `).join('')}
          </div>
        `;
      }

      div.innerHTML = `
        <div class="flex items-start gap-4 max-w-2xl">
          <div class="space-y-2 flex-1">
            ${bandBadge}
            <div class="bg-gray-900 border border-gray-800 rounded-2xl rounded-bl-md px-5 py-4">
              <p class="text-gray-200 leading-relaxed whitespace-pre-line">${escapeHtml(data.answer)}</p>
            </div>
            ${cardHtml}
            ${relatedHtml}
          </div>
        </div>
      `;

      chatHistory.appendChild(div);
      scrollToBottom();
    }

    function addErrorMessage(error) {
      removeTypingIndicator();
      const div = document.createElement('div');
      div.className = 'flex justify-start';
      div.innerHTML = `
        <div class="bg-red-900/50 border border-red-700 rounded-2xl rounded-bl-md px-5 py-4 max-w-2xl">
          <p class="text-red-200">${escapeHtml(error)}</p>
        </div>
      `;
      chatHistory.appendChild(div);
      scrollToBottom();
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function scrollToBottom() {
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    async function submitQuery(question) {
      if (!question.trim()) return;

      addUserMessage(question);
      addTypingIndicator();
      queryInput.value = '';

      try {
        const response = await fetch('/api/jammuse/query', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question })
        });

        const data = await response.json();

        if (data.error) {
          addErrorMessage(data.error);
        } else {
          addBotResponse(data);
        }
      } catch (error) {
        addErrorMessage('Failed to connect to server. Is the backend running?');
      }
    }

    queryForm.addEventListener('submit', (e) => {
      e.preventDefault();
      submitQuery(queryInput.value);
    });

    queryInput.focus();
  </script>

</body>
</html>
