<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JamMuse - Ask Anything About Jam Bands</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }

    /* Rainbow gradient for logo */
    .rainbow-text {
      background: linear-gradient(90deg,
        #ff0000 0%,
        #ff8000 17%,
        #ffff00 33%,
        #00ff00 50%,
        #00bfff 67%,
        #8000ff 83%,
        #ff00ff 100%
      );
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Band-specific gradients */
    .phish-gradient {
      background: linear-gradient(135deg, #e53e3e 0%, #ed8936 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .goose-gradient {
      background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .kglw-gradient {
      background: linear-gradient(135deg, #22c55e 0%, #84cc16 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .dead-gradient {
      background: linear-gradient(135deg, #dc2626 0%, #7c3aed 50%, #2563eb 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo-text {
      font-weight: 800;
      letter-spacing: -0.03em;
    }

    .query-input:focus {
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
    }

    .stat-card {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    }

    .typing-indicator span {
      animation: bounce 1.4s infinite ease-in-out;
    }
    .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
    .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }

    .rainbow-btn {
      background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff);
      background-size: 200% 200%;
      animation: gradient-shift 3s ease infinite;
    }

    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Band badge colors */
    .badge-dead { background: linear-gradient(135deg, #dc2626, #7c3aed, #2563eb); }
    .badge-phish { background: linear-gradient(135deg, #e53e3e, #ed8936); }
    .badge-goose { background: linear-gradient(135deg, #3b82f6, #06b6d4); }
    .badge-kglw { background: linear-gradient(135deg, #22c55e, #84cc16); }
  </style>
</head>
<body class="bg-gray-950 min-h-screen text-white">

  <!-- Header -->
  <header class="border-b border-gray-800">
    <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-lg flex items-center justify-center rainbow-btn">
          <span class="text-white font-black text-lg" style="text-shadow: 0 1px 2px rgba(0,0,0,0.3);">J</span>
        </div>
        <span class="logo-text text-2xl"><span class="rainbow-text">Jam</span><span class="text-white">Muse</span></span>
      </div>
      <div class="text-sm text-gray-500 hidden sm:block">
        Grateful Dead | Phish | Goose | King Gizzard | Umphrey's | Widespread | moe. | STS9 | Billy Strings
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto px-4 py-12">

    <!-- Hero Section -->
    <div class="text-center mb-8">
      <h1 class="text-4xl md:text-5xl font-extrabold mb-4">
        Your home for <span class="rainbow-text">jam band stats</span>
      </h1>
      <p class="text-gray-400 text-lg">
        Follow your groove.
      </p>
    </div>

    <!-- Query Input -->
    <form id="queryForm" class="relative mb-6">
      <input
        type="text"
        id="queryInput"
        placeholder="What's the longest Tweezer ever played?"
        class="query-input w-full pl-6 pr-20 py-4 bg-gray-900 border border-gray-700 rounded-2xl text-lg placeholder-gray-500 focus:outline-none focus:border-purple-500 transition"
        autocomplete="off"
      >
      <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 rainbow-btn px-5 py-2 rounded-xl font-semibold transition hover:opacity-90">
        Ask
      </button>
    </form>

    <!-- Featured Stats - Pre-answered questions -->
    <div id="featuredStats" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
      <!-- Cards will be populated by JavaScript -->
      <div class="stat-card rounded-2xl p-5 border border-gray-700 animate-pulse">
        <div class="h-4 bg-gray-700 rounded w-3/4 mb-3"></div>
        <div class="h-8 bg-gray-700 rounded w-1/2 mb-2"></div>
        <div class="h-3 bg-gray-700 rounded w-full"></div>
      </div>
      <div class="stat-card rounded-2xl p-5 border border-gray-700 animate-pulse">
        <div class="h-4 bg-gray-700 rounded w-3/4 mb-3"></div>
        <div class="h-8 bg-gray-700 rounded w-1/2 mb-2"></div>
        <div class="h-3 bg-gray-700 rounded w-full"></div>
      </div>
      <div class="stat-card rounded-2xl p-5 border border-gray-700 animate-pulse">
        <div class="h-4 bg-gray-700 rounded w-3/4 mb-3"></div>
        <div class="h-8 bg-gray-700 rounded w-1/2 mb-2"></div>
        <div class="h-3 bg-gray-700 rounded w-full"></div>
      </div>
      <div class="stat-card rounded-2xl p-5 border border-gray-700 animate-pulse">
        <div class="h-4 bg-gray-700 rounded w-3/4 mb-3"></div>
        <div class="h-8 bg-gray-700 rounded w-1/2 mb-2"></div>
        <div class="h-3 bg-gray-700 rounded w-full"></div>
      </div>
    </div>

    <!-- Chat History (appears after user asks a question) -->
    <div id="chatHistory" class="space-y-6">
    </div>

  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-800 mt-24">
    <div class="max-w-4xl mx-auto px-4 py-8 text-center text-gray-500 text-sm">
      <p class="mb-2"><span class="rainbow-text font-semibold">JamMuse</span> - Your AI-powered jam band encyclopedia</p>
      <p>Data from Phish.net, elgoose.net, kglw.net</p>
    </div>
  </footer>

  <script>
    const chatHistory = document.getElementById('chatHistory');
    const queryInput = document.getElementById('queryInput');
    const queryForm = document.getElementById('queryForm');

    // Mixed sample questions across all bands - always specify the band name
    const sampleQuestions = [
      // Grateful Dead - has duration data from Archive.org!
      "What's the longest Dark Star ever?",
      "How many times did the Dead play Eyes of the World?",
      "Longest Dead Playing in the Band?",
      "When did the Dead first play Scarlet Begonias?",
      "Top 10 longest Morning Dew",
      "Dead Estimated Prophet stats",
      // Phish
      "What's the longest Phish Tweezer?",
      "How many times has Phish played YEM?",
      "When did Phish last play Fluffhead?",
      "Longest Phish Ghost?",
      "How many times has Phish played Carini?",
      "What's the gap on Phish Harpua?",
      // Goose - has jam chart reviews
      "What's the longest Goose Arcadia?",
      "Best Goose Hungersite versions",
      "How many times has Goose played Tumble?",
      "When did Goose last play Madhuvan?",
      // King Gizzard - has jam chart reviews
      "What's the longest King Gizzard Dripping Tap?",
      "Best King Gizzard River versions",
      "How many times has King Gizzard played Rattlesnake?",
      "When did King Gizzard last play Head On/Pill?",
      // Umphrey's McGee
      "How many times has Umphrey's played Wizard Burial Ground?",
      "When did Umphrey's last play Mantis?",
      "Umphrey's Prowler stats",
      "What's the gap on Umphrey's All in Time?",
      // Widespread Panic
      "How many times has Widespread played Chilly Water?",
      "When did Panic last play Porch Song?",
      "Widespread Space Wrangler stats",
      "What's the gap on Panic Holden Oversoul?",
      // moe.
      "How many times has moe. played Rebubula?",
      "When did moe. last play Buster?",
      "moe. Meat stats",
      "What's the gap on moe. Spine of a Dog?",
      // STS9
      "How many times has STS9 played Scheme?",
      "When did STS9 last play Kamuy?",
      "STS9 World Go Round stats",
      // Billy Strings
      "How many times has Billy Strings played Dust in a Baggie?",
      "When did Billy Strings last play Meet Me at the Creek?",
      "Billy Strings Taking Water stats",
    ];

    // Band styling based on detected band
    const bandStyles = {
      'Grateful Dead': { gradient: 'dead-gradient', badge: 'badge-dead' },
      'Phish': { gradient: 'phish-gradient', badge: 'badge-phish' },
      'Goose': { gradient: 'goose-gradient', badge: 'badge-goose' },
      'King Gizzard': { gradient: 'kglw-gradient', badge: 'badge-kglw' },
      'King Gizzard & the Lizard Wizard': { gradient: 'kglw-gradient', badge: 'badge-kglw' },
    };

    // Featured questions - curated for impressive stats on homepage
    const featuredQuestions = [
      // Grateful Dead - impressive duration stats
      "What's the longest Dark Star ever?",
      "Longest Dead Playing in the Band?",
      "Top 10 longest Morning Dew",
      // Phish - impressive stats
      "What's the longest Phish Tweezer?",
      "Longest Phish Ghost?",
      "How many times has Phish played YEM?",
      // Goose
      "What's the longest Goose Arcadia?",
      "How many times has Goose played Hungersite?",
      // King Gizzard
      "What's the longest King Gizzard Dripping Tap?",
    ];

    function getRandomFeatured(count = 4) {
      const shuffled = [...featuredQuestions].sort(() => Math.random() - 0.5);
      return shuffled.slice(0, count);
    }

    function createFeaturedCard(data, question, index) {
      const band = data.band || 'Unknown';
      const style = getBandStyle(band);

      let statValue = data.highlight || '';
      let statLabel = '';
      let title = '';
      let subtitle = '';
      let queryType = '';

      // Determine query type from the question
      const qLower = question.toLowerCase();
      if (qLower.includes('longest')) {
        queryType = 'Longest';
      } else if (qLower.includes('how many') || qLower.includes('times')) {
        queryType = 'Play Count';
      } else if (qLower.includes('best')) {
        queryType = 'Best';
      } else if (qLower.includes('gap')) {
        queryType = 'Gap';
      } else if (qLower.includes('last')) {
        queryType = 'Last Played';
      }

      if (data.card) {
        // Get the song name from the card title
        let songName = data.card.title || '';
        // Remove "Longest " prefix if already there to avoid "Longest Longest X"
        songName = songName.replace(/^Longest\s+/i, '');

        if (data.card.type === 'longest') {
          title = `Longest ${songName}`;
          statValue = data.card.stat || statValue;
          statLabel = 'duration';
          subtitle = data.card.subtitle || '';
        } else if (data.card.type === 'count' || data.card.type === 'stats') {
          title = songName;
          statValue = data.card.stat || statValue;
          statLabel = data.card.stat_label || 'times played';
          if (data.card.extra) {
            subtitle = data.card.extra.last_played ? `Last: ${data.card.extra.last_played}` : '';
          }
        } else {
          title = songName;
        }
      }

      // Use data attribute to store question (avoids quote escaping issues in onclick)
      return `
        <div class="featured-card stat-card rounded-2xl p-5 border border-gray-700 cursor-pointer hover:border-gray-500 transition group" data-question="${encodeURIComponent(question)}">
          <div class="flex items-start justify-between">
            <div class="flex-1 min-w-0">
              <span class="${style.badge} text-white text-xs font-bold px-2 py-0.5 rounded-full">${escapeHtml(band)}</span>
              <h3 class="text-lg font-bold text-white mt-2 truncate">${escapeHtml(title)}</h3>
              <p class="text-gray-400 text-sm truncate">${escapeHtml(subtitle)}</p>
            </div>
            <div class="text-right ml-4">
              <p class="text-3xl font-extrabold ${style.gradient}">${escapeHtml(statValue)}</p>
              <p class="text-gray-500 text-xs">${escapeHtml(statLabel)}</p>
            </div>
          </div>
          <p class="text-gray-500 text-xs mt-3 group-hover:text-gray-400 transition">Click to explore →</p>
        </div>
      `;
    }

    // Event delegation for featured cards (handles clicks reliably)
    document.getElementById('featuredStats').addEventListener('click', (e) => {
      const card = e.target.closest('.featured-card');
      if (card && card.dataset.question) {
        const question = decodeURIComponent(card.dataset.question);
        askQuestion(question);
      }
    });

    async function loadFeaturedStats() {
      const container = document.getElementById('featuredStats');
      const questions = getRandomFeatured(4);

      // Fetch all 4 in parallel
      const promises = questions.map(async (q) => {
        try {
          const response = await fetch('/api/jammuse/query', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question: q })
          });
          const data = await response.json();
          return { data, question: q };
        } catch (e) {
          return null;
        }
      });

      const results = await Promise.all(promises);
      const validResults = results.filter(r => r && r.data && r.data.success);

      if (validResults.length > 0) {
        container.innerHTML = validResults.map((r, i) => createFeaturedCard(r.data, r.question, i)).join('');
      } else {
        // Fallback to clickable suggestions if API fails
        container.innerHTML = questions.map(q => `
          <div class="featured-card stat-card rounded-2xl p-5 border border-gray-700 cursor-pointer hover:border-gray-500 transition" data-question="${encodeURIComponent(q)}">
            <p class="text-gray-300">${escapeHtml(q)}</p>
            <p class="text-gray-500 text-xs mt-2">Click to search →</p>
          </div>
        `).join('');
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadFeaturedStats();
      // Randomize placeholder
      const randomQ = sampleQuestions[Math.floor(Math.random() * sampleQuestions.length)];
      queryInput.placeholder = randomQ;
    });

    function askQuestion(question) {
      queryInput.value = question;
      submitQuery(question);
    }

    function addUserMessage(question) {
      chatHistory.innerHTML = '';

      const div = document.createElement('div');
      div.className = 'flex justify-end';
      div.innerHTML = `
        <div class="bg-purple-500/20 border border-purple-500/30 rounded-2xl rounded-br-md px-5 py-3 max-w-md">
          <p class="text-purple-200">${escapeHtml(question)}</p>
        </div>
      `;
      chatHistory.appendChild(div);
      scrollToBottom();
    }

    function addTypingIndicator() {
      const div = document.createElement('div');
      div.id = 'typing';
      div.className = 'flex justify-start';
      div.innerHTML = `
        <div class="bg-gray-900 border border-gray-800 rounded-2xl rounded-bl-md px-5 py-4">
          <div class="typing-indicator flex gap-1">
            <span class="w-2 h-2 bg-gray-500 rounded-full"></span>
            <span class="w-2 h-2 bg-gray-500 rounded-full"></span>
            <span class="w-2 h-2 bg-gray-500 rounded-full"></span>
          </div>
        </div>
      `;
      chatHistory.appendChild(div);
      scrollToBottom();
    }

    function removeTypingIndicator() {
      const typing = document.getElementById('typing');
      if (typing) typing.remove();
    }

    function getBandStyle(bandName) {
      return bandStyles[bandName] || { gradient: 'rainbow-text', badge: 'rainbow-btn' };
    }

    function addBotResponse(data) {
      removeTypingIndicator();

      const band = data.band || 'Unknown';
      const style = getBandStyle(band);

      const div = document.createElement('div');
      div.className = 'flex justify-start';

      // Band badge
      const bandBadge = band ? `
        <span class="${style.badge} text-white text-xs font-bold px-2 py-1 rounded-full mb-2 inline-block">
          ${escapeHtml(band)}
        </span>
      ` : '';

      let cardHtml = '';
      if (data.card) {
        if (data.card.type === 'longest') {
          cardHtml = `
            <div class="stat-card rounded-2xl p-6 border border-gray-700 mt-4">
              <div class="flex items-start justify-between mb-4">
                <div>
                  <p class="text-gray-400 text-sm uppercase tracking-wide">Longest Performance</p>
                  <h2 class="text-2xl font-bold text-white mt-1">${escapeHtml(data.card.title)}</h2>
                </div>
                <div class="text-right">
                  <p class="text-4xl font-extrabold ${style.gradient}">${escapeHtml(data.card.stat)}</p>
                  <p class="text-gray-500 text-sm">duration</p>
                </div>
              </div>
              <div class="border-t border-gray-700 pt-4">
                <p class="text-gray-300">${escapeHtml(data.card.subtitle || '')}</p>
                ${data.card.context ? `<p class="text-gray-500 text-sm mt-1">${escapeHtml(data.card.context)}</p>` : ''}
              </div>
              ${data.card.extra ? `
                <div class="grid grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-700">
                  <div>
                    <p class="text-gray-500 text-xs">Avg Duration</p>
                    <p class="text-white font-semibold">${escapeHtml(data.card.extra.avg_duration || 'N/A')}</p>
                  </div>
                  <div>
                    <p class="text-gray-500 text-xs">Performances</p>
                    <p class="text-white font-semibold">${data.card.extra.performances_with_data || data.card.extra.total_performances || 'N/A'}</p>
                  </div>
                </div>
              ` : ''}
            </div>
          `;
        } else if (data.card.type === 'count' || data.card.type === 'stats' || data.card.type === 'gap') {
          cardHtml = `
            <div class="stat-card rounded-2xl p-6 border border-gray-700 mt-4">
              <div class="flex items-center justify-between">
                <div>
                  <h2 class="text-2xl font-bold text-white">${escapeHtml(data.card.title)}</h2>
                  <p class="text-gray-400 text-sm mt-1">${escapeHtml(data.card.subtitle || '')}</p>
                </div>
                ${data.card.stat !== undefined ? `
                  <div class="text-center">
                    <p class="text-5xl font-extrabold ${style.gradient}">${data.card.stat}</p>
                    <p class="text-gray-500 text-sm">${escapeHtml(data.card.stat_label || '')}</p>
                  </div>
                ` : ''}
              </div>
              ${data.card.extra ? `
                <div class="grid grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-700">
                  ${data.card.extra.first_played ? `
                    <div>
                      <p class="text-gray-500 text-xs">First Played</p>
                      <p class="text-white font-semibold">${escapeHtml(data.card.extra.first_played)}</p>
                    </div>
                  ` : ''}
                  ${data.card.extra.last_played ? `
                    <div>
                      <p class="text-gray-500 text-xs">Last Played</p>
                      <p class="text-white font-semibold">${escapeHtml(data.card.extra.last_played)}</p>
                    </div>
                  ` : ''}
                  ${data.card.extra.gap !== undefined ? `
                    <div>
                      <p class="text-gray-500 text-xs">Current Gap</p>
                      <p class="text-white font-semibold">${data.card.extra.gap} shows</p>
                    </div>
                  ` : ''}
                  ${data.card.extra.jamchart_count !== undefined ? `
                    <div>
                      <p class="text-gray-500 text-xs">Jam Charted</p>
                      <p class="text-white font-semibold">${data.card.extra.jamchart_count} times (${data.card.extra.jamchart_rate || 'N/A'})</p>
                    </div>
                  ` : ''}
                  ${data.card.extra.venue ? `
                    <div class="col-span-2">
                      <p class="text-gray-500 text-xs">Venue</p>
                      <p class="text-white font-semibold">${escapeHtml(data.card.extra.venue)}</p>
                    </div>
                  ` : ''}
                </div>
              ` : ''}
            </div>
          `;
        } else if (data.card.type === 'jamchart') {
          cardHtml = `
            <div class="stat-card rounded-2xl p-6 border border-gray-700 mt-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-400 text-sm uppercase tracking-wide">Jam Chart</p>
                  <h2 class="text-2xl font-bold text-white mt-1">${escapeHtml(data.card.title)}</h2>
                </div>
                ${data.card.extra && data.card.extra.entries ? `
                  <div class="text-center">
                    <p class="text-4xl font-extrabold ${style.gradient}">${data.card.extra.entries}</p>
                    <p class="text-gray-500 text-sm">entries</p>
                  </div>
                ` : ''}
              </div>
            </div>
          `;
        } else if (data.card.type === 'duration') {
          cardHtml = `
            <div class="stat-card rounded-2xl p-6 border border-gray-700 mt-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-400 text-sm uppercase tracking-wide">Average Duration</p>
                  <h2 class="text-2xl font-bold text-white mt-1">${escapeHtml(data.card.title)}</h2>
                </div>
                <div class="text-center">
                  <p class="text-4xl font-extrabold ${style.gradient}">${escapeHtml(data.card.stat)}</p>
                  <p class="text-gray-500 text-sm">${escapeHtml(data.card.stat_label || 'minutes')}</p>
                </div>
              </div>
              ${data.card.extra ? `
                <div class="grid grid-cols-3 gap-4 mt-4 pt-4 border-t border-gray-700">
                  <div>
                    <p class="text-gray-500 text-xs">Shortest</p>
                    <p class="text-white font-semibold">${escapeHtml(data.card.extra.min || 'N/A')}</p>
                  </div>
                  <div>
                    <p class="text-gray-500 text-xs">Longest</p>
                    <p class="text-white font-semibold">${escapeHtml(data.card.extra.max || 'N/A')}</p>
                  </div>
                  <div>
                    <p class="text-gray-500 text-xs">Samples</p>
                    <p class="text-white font-semibold">${data.card.extra.count || 'N/A'}</p>
                  </div>
                </div>
              ` : ''}
            </div>
          `;
        }
      }

      let relatedHtml = '';
      if (data.related && data.related.length > 0) {
        relatedHtml = `
          <div class="flex flex-wrap gap-2 mt-4">
            <span class="text-gray-500 text-sm">Related:</span>
            ${data.related.map(q => `
              <button onclick="askQuestion('${escapeHtml(q)}')" class="px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-sm transition">${escapeHtml(q)}</button>
            `).join('')}
          </div>
        `;
      }

      div.innerHTML = `
        <div class="flex items-start gap-4 max-w-2xl">
          <div class="space-y-2 flex-1">
            ${bandBadge}
            <div class="bg-gray-900 border border-gray-800 rounded-2xl rounded-bl-md px-5 py-4">
              <p class="text-gray-200 leading-relaxed whitespace-pre-line">${escapeHtml(data.answer)}</p>
            </div>
            ${cardHtml}
            ${relatedHtml}
          </div>
        </div>
      `;

      chatHistory.appendChild(div);
      scrollToBottom();
    }

    function addErrorMessage(error) {
      removeTypingIndicator();
      const div = document.createElement('div');
      div.className = 'flex justify-start';
      div.innerHTML = `
        <div class="bg-red-900/50 border border-red-700 rounded-2xl rounded-bl-md px-5 py-4 max-w-2xl">
          <p class="text-red-200">${escapeHtml(error)}</p>
        </div>
      `;
      chatHistory.appendChild(div);
      scrollToBottom();
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function scrollToBottom() {
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    async function submitQuery(question) {
      if (!question.trim()) return;

      addUserMessage(question);
      addTypingIndicator();
      queryInput.value = '';

      try {
        const response = await fetch('/api/jammuse/query', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question })
        });

        const data = await response.json();

        if (data.error) {
          addErrorMessage(data.error);
        } else {
          addBotResponse(data);
        }
      } catch (error) {
        addErrorMessage('Failed to connect to server. Is the backend running?');
      }
    }

    queryForm.addEventListener('submit', (e) => {
      e.preventDefault();
      submitQuery(queryInput.value);
    });

    queryInput.focus();
  </script>

</body>
</html>
